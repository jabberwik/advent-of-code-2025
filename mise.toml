[tools]
dotnet = "10"

[env]
AOC_SESSION = { required = true }

[tasks.prep]
quiet = true
description = "Sets up a new day's project structure"
usage = '''
arg "<day>" help="Day number"
'''
run = '''
day="${usage_day:?}"
day_padded=$(printf "%02d" "$day")
outdir="day-$day_padded"
mkdir -p "$outdir"

# Copy all files from template and rename them
for file in .day-template/day-NN.*; do
  filename=$(basename "$file")
  newname="${filename/day-NN/day-$day_padded}"
  cp "$file" "$outdir/$newname"
  # Replace placeholders in each file (build placeholder to avoid Tera parsing)
  sed -i "" "s/{""{DAY_PADDED}}/$day_padded/g" "$outdir/$newname"
done

dotnet sln add day-$day_padded
echo "Created project structure for day $day in $outdir"
'''

[tasks.fetch]
alias = 'f'
quiet = true
description = "Download Advent of Code input for a given day"
usage = '''
arg "<day>" help="Day number"
flag "--token <token>" env="AOC_SESSION"
'''
run = '''
day="${usage_day:?}"
token="${usage_token:?}"

url="https://adventofcode.com/2025/day/$day/input"
day_padded=$(printf "%02d" "$day")
outdir="day-$day_padded"
outfile="$outdir/input.txt"

mkdir -p "$outdir"

curl -sS "$url" -b "session=$token" -o "$outfile"
echo "Downloaded input for day $day to $outfile"
'''

[tasks.test]
alias = 't'
quiet = true
description = "Runs the test code for a given day"
usage = '''
arg "<day>" help="Day number"
'''
run = '''
day="${usage_day:?}"
day_padded=$(printf "%02d" "$day")
dotnet test "day-$day_padded"
'''

[tasks.go]
quiet = true
description = "Runs the solution code for a given day"
usage = '''
arg "<day>" help="Day number"
'''
run = '''
day="${usage_day:?}"
day_padded=$(printf "%02d" "$day")
dotnet run --project "day-$day_padded" -- "./day-$day_padded/input.txt"
'''
